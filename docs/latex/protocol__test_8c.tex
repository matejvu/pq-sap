\doxysection{tests/protocol\+\_\+test.c File Reference}
\hypertarget{protocol__test_8c}{}\label{protocol__test_8c}\index{tests/protocol\_test.c@{tests/protocol\_test.c}}
{\ttfamily \#include "{}protocol\+\_\+api.\+h"{}}\newline
{\ttfamily \#include "{}stdio.\+h"{}}\newline
Include dependency graph for protocol\+\_\+test.\+c\+:
% FIG 0
\doxysubsubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
int \mbox{\hyperlink{protocol__test_8c_ae66f6b31b5ad750f1fe042a706a4e3d4}{main}} ()
\begin{DoxyCompactList}\small\item\em Main function that runs the SAP Protocol test. \end{DoxyCompactList}\end{DoxyCompactItemize}


\doxysubsection{Function Documentation}
\Hypertarget{protocol__test_8c_ae66f6b31b5ad750f1fe042a706a4e3d4}\label{protocol__test_8c_ae66f6b31b5ad750f1fe042a706a4e3d4} 
\index{protocol\_test.c@{protocol\_test.c}!main@{main}}
\index{main@{main}!protocol\_test.c@{protocol\_test.c}}
\doxysubsubsection{\texorpdfstring{main()}{main()}}
{\footnotesize\ttfamily int main (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Main function that runs the SAP Protocol test. 

This function simulates the key exchange and stealth address generation process within the SAP protocol. It includes key pair generation, computation of the shared secret and view tag by the sender, and stealth address generation by both the sender and recipient. The test is passed if the stealth addresses generated by the sender and recipient match.

\begin{DoxyReturn}{Returns}
0 if the test passes, indicating successful execution; otherwise, returns early on failure. 
\end{DoxyReturn}
Local variables\+:


\begin{DoxyItemize}
\item k\+\_\+pub\mbox{[}\doxylink{params_8h_a7663b32715a32f12eb70420793753ce3}{KYBER\+\_\+\+PUBLICKEYBYTES}\mbox{]}\+: Public key for key exchange
\end{DoxyItemize}


\begin{DoxyItemize}
\item v\+\_\+pub\mbox{[}\doxylink{params_8h_a7663b32715a32f12eb70420793753ce3}{KYBER\+\_\+\+PUBLICKEYBYTES}\mbox{]}\+: Public key for the view address
\end{DoxyItemize}


\begin{DoxyItemize}
\item k\+\_\+priv\mbox{[}\doxylink{params_8h_a7f9a2f9ae6937442f988816af97babb3}{KYBER\+\_\+\+SECRETKEYBYTES}\mbox{]}\+: Secret key for key exchange
\end{DoxyItemize}


\begin{DoxyItemize}
\item v\+\_\+priv\mbox{[}\doxylink{params_8h_a7f9a2f9ae6937442f988816af97babb3}{KYBER\+\_\+\+SECRETKEYBYTES}\mbox{]}\+: Secret key for the view address
\end{DoxyItemize}


\begin{DoxyItemize}
\item ephemeral\+\_\+pub\+\_\+key\mbox{[}\doxylink{protocol__api_8h_a84c301f8e1f57a825bbd2dcab697fc5e}{CIPHERTEXT\+\_\+\+BYTES}\mbox{]}\+: Ephemeral public key used in the protocol
\end{DoxyItemize}


\begin{DoxyItemize}
\item view\+\_\+tag\+: View tag computed by the sender, used for generating the stealth address
\end{DoxyItemize}


\begin{DoxyItemize}
\item stealth\+\_\+pub\+\_\+key\+\_\+sender\mbox{[}\doxylink{protocol_8c_ac42ee8dc097e52d63dd4e8371d769d12}{STEALTH\+\_\+\+ADDRESS\+\_\+\+BYTES}\mbox{]}\+: Stealth public key generated by the sender
\end{DoxyItemize}


\begin{DoxyItemize}
\item stealth\+\_\+pub\+\_\+key\+\_\+reciever\mbox{[}\doxylink{protocol_8c_ac42ee8dc097e52d63dd4e8371d769d12}{STEALTH\+\_\+\+ADDRESS\+\_\+\+BYTES}\mbox{]}\+: Stealth public key generated by the recipient
\end{DoxyItemize}


\begin{DoxyItemize}
\item ss\mbox{[}\doxylink{params_8h_a5054c9269277412d8536eb82cfffbe15}{KYBER\+\_\+\+SSBYTES}\mbox{]}\+: Shared secret from the sender\textquotesingle{}s computation (sender\textquotesingle{}s shared secret)
\end{DoxyItemize}


\begin{DoxyItemize}
\item ss2\mbox{[}\doxylink{params_8h_a5054c9269277412d8536eb82cfffbe15}{KYBER\+\_\+\+SSBYTES}\mbox{]}\+: Shared secret from the recipient\textquotesingle{}s computation (recipient\textquotesingle{}s shared secret)
\end{DoxyItemize}

SAP Protocol\+:
\begin{DoxyEnumerate}
\item Generate key pair for both the sender and recipient. The sender generates a public/private key pair calling \doxylink{kem_8h_affcceebbb34b0fcdd82918c9dd6f80ef}{crypto\+\_\+kem\+\_\+keypair(k\+\_\+pub, k\+\_\+priv)}, and the recipient generates their own keys calling \doxylink{kem_8h_affcceebbb34b0fcdd82918c9dd6f80ef}{crypto\+\_\+kem\+\_\+keypair(v\+\_\+pub, v\+\_\+priv)}
\end{DoxyEnumerate}


\begin{DoxyEnumerate}
\item Sender computes the shared secret and view tag using the public keys( sender\+\_\+computes\+\_\+stealth\+\_\+pub\+\_\+key\+\_\+and\+\_\+viewtag() )
\end{DoxyEnumerate}


\begin{DoxyEnumerate}
\item Recipient computes the stealth public key based on the sender\textquotesingle{}s ephemeral public key. The recipient calculates their own stealth address based on their private key, the sender\textquotesingle{}s public key, and the sender\textquotesingle{}s ephemeral public key. Calling \doxylink{protocol_8c_a858f8d44b117050df006c629482959fc}{recipient\+\_\+computes\+\_\+stealth\+\_\+pub\+\_\+key()}
\end{DoxyEnumerate}


\begin{DoxyEnumerate}
\item Verify that the stealth public keys generated by the sender and recipient match. The final step of the protocol is to compare the stealth public key computed by the sender and recipient. If they match, the test passes, indicating that the protocol works correctly. Test fails if the computed stealth public keys do not match
\end{DoxyEnumerate}